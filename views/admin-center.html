<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç®¡ç†ä¸­å¿ƒ - ç°ä»£å›¾åºŠ</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234361ee'><path d='M4 5h13v7h2V5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h8v-2H4V5zm19 7v10c0 1.1-.9 2-2 2H8c-1.1 0-2-.9-2-2V12c0-1.1.9-2 2-2h13c1.1 0 2 .9 2 2zm-2 0H8v10h13V12z'/></svg>">
  <style>
    .admin-center {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-lg);
    }
    
    .page-header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-lg);
      border-bottom: 2px solid var(--primary-color);
    }
    
    .page-header h1 {
      color: var(--primary-color);
      font-size: 2.5rem;
      margin-bottom: var(--spacing-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-md);
    }
    
    .page-header .subtitle {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }
    
    .admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }
    
    .admin-card {
      background: var(--bg-color);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-lg);
      border: 1px solid var(--border-color);
      box-shadow: var(--box-shadow);
      transition: all var(--transition-speed) ease;
      position: relative;
      overflow: hidden;
    }
    
    .admin-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(67, 97, 238, 0.15);
      border-color: var(--primary-light);
    }
    
    .admin-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
    }
    
    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }
    
    .card-icon {
      font-size: 2rem;
      margin-right: var(--spacing-md);
      padding: var(--spacing-sm);
      border-radius: var(--border-radius);
      background: var(--primary-light);
      color: var(--primary-color);
    }
    
    .card-title {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--text-color);
      margin: 0;
    }
    
    .card-description {
      color: var(--text-secondary);
      margin-bottom: var(--spacing-lg);
      line-height: 1.6;
    }
    
    .card-features {
      list-style: none;
      padding: 0;
      margin: 0 0 var(--spacing-lg) 0;
    }
    
    .card-features li {
      padding: var(--spacing-xs) 0;
      color: var(--text-secondary);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
    }
    
    .card-features li::before {
      content: 'âœ“';
      color: var(--primary-color);
      font-weight: bold;
      margin-right: var(--spacing-sm);
    }
    
    .card-actions {
      display: flex;
      gap: var(--spacing-sm);
      flex-wrap: wrap;
    }
    
    .btn-card {
      flex: 1;
      min-width: 120px;
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--border-radius);
      text-decoration: none;
      text-align: center;
      font-weight: 500;
      transition: all var(--transition-speed) ease;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
    }
    
    .btn-primary {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }
    
    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }
    
    .btn-secondary:hover {
      background: var(--gray-100);
      border-color: var(--primary-light);
    }
    
    .stats-section {
      background: var(--bg-color);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
      border: 1px solid var(--border-color);
      box-shadow: var(--box-shadow);
    }
    
    .stats-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-lg);
    }
    
    .stats-header h2 {
      color: var(--text-color);
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-md);
    }
    
    .stat-item {
      background: var(--bg-secondary);
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      text-align: center;
      border: 1px solid var(--border-color);
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: var(--primary-color);
      display: block;
      margin-bottom: var(--spacing-xs);
    }
    
    .stat-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    .quick-actions {
      background: var(--bg-color);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-lg);
      border: 1px solid var(--border-color);
      box-shadow: var(--box-shadow);
    }
    
    .quick-actions h2 {
      color: var(--text-color);
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .quick-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: var(--spacing-md);
    }
    
    .quick-btn {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--spacing-md);
      text-decoration: none;
      color: var(--text-color);
      text-align: center;
      transition: all var(--transition-speed) ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .quick-btn:hover {
      background: var(--primary-light);
      border-color: var(--primary-color);
      transform: translateY(-2px);
    }
    
    .quick-btn-icon {
      font-size: 1.8rem;
    }
    
    .quick-btn-text {
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    @media (max-width: 768px) {
      .admin-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .quick-buttons {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .page-header h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container header-content">
      <a href="/" class="logo">ç°ä»£å›¾åºŠ</a>
      <nav class="nav">
        <a href="/" class="btn btn-outline">é¦–é¡µ</a>
        <a href="/gallery" class="btn btn-outline">å›¾ç‰‡åº“</a>
        <a href="/categories" class="btn btn-outline">åˆ†ç±»ç®¡ç†</a>
        <a href="/admin-center" class="btn btn-primary">ç®¡ç†ä¸­å¿ƒ</a>
        <a href="/settings" class="btn btn-outline">ç³»ç»Ÿè®¾ç½®</a>
        <button id="toggleDarkMode" class="btn btn-outline">æš—è‰²æ¨¡å¼</button>
        <a href="/logout" class="btn btn-outline">é€€å‡º</a>
      </nav>
    </div>
  </header>

  <main class="admin-center">
    <div class="page-header">
      <h1>
        <span>ğŸ›ï¸</span>
        ç®¡ç†ä¸­å¿ƒ
      </h1>
      <p class="subtitle">ç»Ÿä¸€ç®¡ç†å›¾åºŠç³»ç»Ÿçš„å„é¡¹åŠŸèƒ½å’Œé…ç½®</p>
    </div>

    <!-- ç³»ç»ŸçŠ¶æ€ç»Ÿè®¡ -->
    <div class="stats-section">
      <div class="stats-header">
        <h2>
          <span>ğŸ“Š</span>
          ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ
        </h2>
        <button id="refreshStats" class="btn btn-secondary">
          <span>ğŸ”„</span>
          åˆ·æ–°
        </button>
      </div>
      <div class="stats-grid" id="statsGrid">
        <div class="stat-item">
          <span class="stat-value" id="totalImages">-</span>
          <span class="stat-label">æ€»å›¾ç‰‡æ•°</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="totalStorage">-</span>
          <span class="stat-label">å­˜å‚¨ç©ºé—´</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="apiTokens">-</span>
          <span class="stat-label">APIä»¤ç‰Œ</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="redisStatus">-</span>
          <span class="stat-label">RedisçŠ¶æ€</span>
        </div>
      </div>
    </div>

    <!-- ä¸»è¦ç®¡ç†åŠŸèƒ½ -->
    <div class="admin-grid">
      <!-- æ•°æ®ç®¡ç† -->
      <div class="admin-card">
        <div class="card-header">
          <div class="card-icon">ğŸ—„ï¸</div>
          <h3 class="card-title">æ•°æ®ç®¡ç†</h3>
        </div>
        <p class="card-description">
          ç®¡ç†å›¾ç‰‡æ•°æ®åº“ã€å¤‡ä»½æ¢å¤ã€æ•°æ®è¿ç§»ç­‰åŠŸèƒ½ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚
        </p>
        <ul class="card-features">
          <li>PostgreSQLæ•°æ®åº“ç®¡ç†</li>
          <li>æ•°æ®å¤‡ä»½ä¸æ¢å¤</li>
          <li>å›¾ç‰‡æ•°æ®è¿ç§»</li>
          <li>SQLiteæ•°æ®å¯¼å…¥</li>
          <li>è‡ªåŠ¨å¤‡ä»½è®¾ç½®</li>
        </ul>
        <div class="card-actions">
          <a href="/migrate" class="btn-card btn-primary">
            <span>ğŸ”§</span>
            æ•°æ®ç®¡ç†
          </a>
        </div>
      </div>

      <!-- Redisç¼“å­˜ç®¡ç† -->
      <div class="admin-card">
        <div class="card-header">
          <div class="card-icon">âš¡</div>
          <h3 class="card-title">Redisç¼“å­˜ç®¡ç†</h3>
        </div>
        <p class="card-description">
          ç®¡ç†Redisç¼“å­˜æœåŠ¡ï¼Œä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ï¼Œç›‘æ§ç¼“å­˜çŠ¶æ€ã€‚
        </p>
        <ul class="card-features">
          <li>ç¼“å­˜çŠ¶æ€ç›‘æ§</li>
          <li>ç¼“å­˜æ¸…ç†æ“ä½œ</li>
          <li>TTLæ—¶é—´é…ç½®</li>
          <li>å†…å­˜ä½¿ç”¨ç»Ÿè®¡</li>
          <li>è¿æ¥çŠ¶æ€æ£€æŸ¥</li>
        </ul>
        <div class="card-actions">
          <a href="/redis-management" class="btn-card btn-primary">
            <span>âš¡</span>
            Redisç®¡ç†
          </a>
        </div>
      </div>

      <!-- APIç®¡ç† -->
      <div class="admin-card">
        <div class="card-header">
          <div class="card-icon">ğŸ”§</div>
          <h3 class="card-title">APIç®¡ç†</h3>
        </div>
        <p class="card-description">
          ç®¡ç†APIä»¤ç‰Œã€é…ç½®APIå‚æ•°ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹å·¥å…·é›†æˆã€‚
        </p>
        <ul class="card-features">
          <li>APIä»¤ç‰Œåˆ›å»ºä¸ç®¡ç†</li>
          <li>APIçŠ¶æ€å¼€å…³</li>
          <li>é»˜è®¤æ ¼å¼è®¾ç½®</li>
          <li>PicGoé…ç½®æŒ‡å—</li>
          <li>APIä½¿ç”¨æ–‡æ¡£</li>
        </ul>
        <div class="card-actions">
          <a href="/api-management" class="btn-card btn-primary">
            <span>ğŸ”§</span>
            APIç®¡ç†
          </a>
        </div>
      </div>

      <!-- å­˜å‚¨é…ç½® -->
      <div class="admin-card">
        <div class="card-header">
          <div class="card-icon">ğŸ’¾</div>
          <h3 class="card-title">å­˜å‚¨é…ç½®</h3>
        </div>
        <p class="card-description">
          é…ç½®æœ¬åœ°å­˜å‚¨å’Œäº‘å­˜å‚¨ï¼Œç®¡ç†å­˜å‚¨ç©ºé—´å’Œè®¿é—®æ–¹å¼ã€‚
        </p>
        <ul class="card-features">
          <li>æœ¬åœ°å­˜å‚¨è®¾ç½®</li>
          <li>Cloudflare R2é…ç½®</li>
          <li>å­˜å‚¨ç©ºé—´ç»Ÿè®¡</li>
          <li>è‡ªå®šä¹‰åŸŸå</li>
          <li>å­˜å‚¨æµ‹è¯•å·¥å…·</li>
        </ul>
        <div class="card-actions">
          <a href="/storage-config" class="btn-card btn-primary">
            <span>ğŸ’¾</span>
            å­˜å‚¨é…ç½®
          </a>
        </div>
      </div>

      <!-- ç³»ç»Ÿè°ƒè¯• -->
      <div class="admin-card">
        <div class="card-header">
          <div class="card-icon">ğŸ”</div>
          <h3 class="card-title">ç³»ç»Ÿè°ƒè¯•</h3>
        </div>
        <p class="card-description">
          ç³»ç»Ÿè°ƒè¯•å·¥å…·ï¼Œæ£€æŸ¥å„ç»„ä»¶çŠ¶æ€ï¼Œæ’æŸ¥é—®é¢˜ã€‚
        </p>
        <ul class="card-features">
          <li>ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</li>
          <li>R2è¿æ¥æµ‹è¯•</li>
          <li>Redisè¿æ¥æµ‹è¯•</li>
          <li>é”™è¯¯æ—¥å¿—æŸ¥çœ‹</li>
          <li>æ€§èƒ½ç›‘æ§</li>
        </ul>
        <div class="card-actions">
          <a href="/debug" class="btn-card btn-primary">
            <span>ğŸ”</span>
            ç³»ç»Ÿè°ƒè¯•
          </a>
        </div>
      </div>

      <!-- HTTPSæµ‹è¯• -->
      <div class="admin-card">
        <div class="card-header">
          <div class="card-icon">ğŸ”’</div>
          <h3 class="card-title">HTTPSæµ‹è¯•</h3>
        </div>
        <p class="card-description">
          æµ‹è¯•HTTPSè¿æ¥ï¼Œæ£€æŸ¥SSLè¯ä¹¦ï¼Œç¡®ä¿ç½‘ç«™å®‰å…¨ã€‚
        </p>
        <ul class="card-features">
          <li>HTTPSè¿æ¥æµ‹è¯•</li>
          <li>SSLè¯ä¹¦æ£€æŸ¥</li>
          <li>å®‰å…¨æ€§è¯„ä¼°</li>
          <li>åè®®å…¼å®¹æ€§</li>
          <li>æ€§èƒ½æµ‹è¯•</li>
        </ul>
        <div class="card-actions">
          <a href="/test-https" class="btn-card btn-primary">
            <span>ğŸ”’</span>
            HTTPSæµ‹è¯•
          </a>
        </div>
      </div>
    </div>

    <!-- å¿«é€Ÿæ“ä½œ -->
    <div class="quick-actions">
      <h2>
        <span>âš¡</span>
        å¿«é€Ÿæ“ä½œ
      </h2>
      <div class="quick-buttons">
        <a href="/gallery" class="quick-btn">
          <span class="quick-btn-icon">ğŸ–¼ï¸</span>
          <span class="quick-btn-text">å›¾ç‰‡åº“</span>
        </a>
        <a href="/settings" class="quick-btn">
          <span class="quick-btn-icon">âš™ï¸</span>
          <span class="quick-btn-text">ç³»ç»Ÿè®¾ç½®</span>
        </a>
        <a href="/" class="quick-btn">
          <span class="quick-btn-icon">ğŸ“¤</span>
          <span class="quick-btn-text">ä¸Šä¼ å›¾ç‰‡</span>
        </a>
        <a href="/logout" class="quick-btn">
          <span class="quick-btn-icon">ğŸšª</span>
          <span class="quick-btn-text">é€€å‡ºç™»å½•</span>
        </a>
      </div>
    </div>
  </main>

  <script src="/js/auth-check.js"></script>
  <script>
    // åŠ è½½ç³»ç»ŸçŠ¶æ€ç»Ÿè®¡
    async function loadSystemStats() {
      try {
        // è·å–å›¾ç‰‡ç»Ÿè®¡
        const imagesResponse = await fetch('/api/storage-stats');
        const imagesData = await imagesResponse.json();
        
        // æå–å›¾ç‰‡æ•°é‡å’Œç©ºé—´å ç”¨
        const totalImages = imagesData.stats ? imagesData.stats.total : imagesData.totalImages;
        const totalBytes = imagesData.sizes ? imagesData.sizes.total : imagesData.totalSize;
        document.getElementById('totalImages').textContent = totalImages || 0;
        document.getElementById('totalStorage').textContent = formatBytes(totalBytes || 0);
        
        // è·å–APIä»¤ç‰Œæ•°é‡
        const tokensResponse = await fetch('/api/tokens');
        const tokensData = await tokensResponse.json();
        
        // è·å–RedisçŠ¶æ€
        const redisResponse = await fetch('/api/debug/redis-status');
        const redisData = await redisResponse.json();
        
        document.getElementById('apiTokens').textContent = tokensData.tokens?.length || 0;
        const redisConnected = redisData.redis ? redisData.redis.connected : redisData.connected;
        document.getElementById('redisStatus').textContent = redisConnected ? 'å·²è¿æ¥' : 'æœªè¿æ¥';
        
        // æ ¹æ®RedisçŠ¶æ€è®¾ç½®é¢œè‰²
        const redisStatusEl = document.getElementById('redisStatus');
        redisStatusEl.style.color = redisConnected ? 'var(--success-color)' : 'var(--error-color)';
        
      } catch (error) {
        console.error('åŠ è½½ç³»ç»Ÿç»Ÿè®¡å¤±è´¥:', error);
      }
    }

    // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
    function formatBytes(bytes, decimals = 2) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const dm = decimals < 0 ? 0 : decimals;
      const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      loadSystemStats();
      
      // åˆ·æ–°æŒ‰é’®äº‹ä»¶
      document.getElementById('refreshStats').addEventListener('click', loadSystemStats);
    });
  </script>
  <script src="/js/auth-check.js"></script>
  <script src="/js/dark-mode.js"></script>
</body>
</html> 